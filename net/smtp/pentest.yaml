description: Стандартные тесты SMTP
author: hacktricks
tags:
  - 25
  - 465
  - 587
  - smpt
install:
  sudo apt install ismtp
arguments:
  targs:
    default:
    replacer: __TARGS__
    description: >-
      Цели для тестирования (пример: '127.0.0.1:25 127.0.0.2:465')
  to:
    default: twerkbird@rambler.ru
    replacer: __MAILTO__
    description: e-mail получателя при проверке на Open Relay (используется в item 4)
  from:
    default: notexist@notexist.ru
    replacer: __MAILFROM__
    description: e-mail отправителя при проверке на Open Relay (используется в item 4)
  e:
    default: " "
    replacer: __USERLIST__
    description: Путь до списка email-ов для перечисления (используется в item 5)
shell: /bin/bash
script:
item_1:
  description: Тесты nmap
  script: >-
    for i in __TARGS__; do sudo nmap -sS -Pn -sV --script=smtp-commands,smtp-ntlm-info,smtp-open-relay,smtp-strangeport,smtp-vuln-cve2010-4344,smtp-vuln-cve2011-1720,smtp-vuln-cve2011-1764 -p$(echo $i | cut -f2 -d:) $(echo $i | cut -f1 -d:); echo -e; done
item_2:
  description: Получение банеров с помощью ncat
  script: >-
    for i in __TARGS__; do echo "Connection to $i:"; echo "quit" | ncat $(echo $i | cut -f1 -d:) $(echo $i | cut -f2 -d:); echo -e; done
item_3:
  description: Тест на открытый релей
  script: >-
    msfprms="use auxiliary/scanner/smtp/smtp_relay;set MAILTO __MAILTO__; set MAILFROM __MAILFROM__; set EXTENDED true;"; for i in __TARGS__; do msfprms+="set rhosts $(echo $i | cut -f1 -d:); set rport $(echo $i | cut -f2 -d:); run; "; done; msfprms+="quit"; msfconsole -q -x "$msfprms"
item_4:
  description: Перечисление пользователей
  script: >-
    for i in __TARGS__; do ismtp -h $i -e __USERLIST__; done